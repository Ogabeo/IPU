{% extends "base.html" %}
{% load static %}
{% load custom_filters %}
{% block title %}
Fanlar
{% endblock title %}



{% block context %}
<section class="relative h-screen flex items-center justify-center text-center overflow-hidden">
  <!-- Orqa fon rasmi -->
  <img src="{% static 'img/subject.jpg' %}" 
       alt="Banner" 
       class="absolute inset-0 w-full h-full object-cover" />

  <!-- Oq gradient (pastdan boshlab tepaga tiniqlashadi) -->
  <div class="absolute inset-0 bg-gradient-to-t from-white via-white/80 to-transparent"></div>

  <!-- Matn qismi -->
  <div class="relative z-10 px-6">
    <h1 class="text-4xl sm:text-6xl font-serif font-semibold text-gray-900 mb-6 animate-slideUp">
      Kompyuter tizimlari kafedrasida oâ€˜qitiladigan fanlar majmui
    </h1>
    <p class="text-lg sm:text-xl text-gray-700 max-w-2xl mx-auto animate-slideUp delay-200">
      Kafedramizda oâ€˜qitiladigan barcha fanlar haqida batafsil ma'lumotni shu yerda topasiz
    </p>
  </div>
</section>

<!-- ðŸ”¹ Animatsiya uchun CSS -->
<style>
@keyframes slideUp {
  0% {
    opacity: 0;
    transform: translateY(50px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-slideUp {
  animation: slideUp 1.2s ease-out forwards;
}

.delay-200 {
  animation-delay: 0.3s;
}
</style>



<div class="relative pt-2 lg:pt-2 min-h-screen max-w-screen-xl mx-auto p-4 sm:mb-8 mb-4">
   
    <!-- search -->
    <div class="max-w-5xl mx-auto mb-10">
      <form class="w-full flex flex-col sm:flex-row gap-4 items-center justify-center search_component bg-white p-4 rounded-xl shadow-[0_2px_10px_-3px_rgba(6,0,0,0.3)]">
        
        <!-- Ta'lim shakli -->
        <select id="talim_shakli" name="talim_shakli"
          class="sm:w-[22%] w-full border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg p-3 text-sm">
          <option value="" selected="">Ta'lim shakli</option>
          <option value="kunduzgi" {% if filter_by_category == 'kunduzgi' %}selected{% endif %}>kunduzgi</option>
          <option value="sirtqi" {% if filter_by_category == 'sirtqi' %}selected{% endif %}>sirtqi</option>
          <option value="masofaviy" {% if filter_by_category == 'masofaviy' %}selected{% endif %}>masofaviy</option>
        </select>

        <!-- Kurslar -->
        <select id="course" name="course"
          class="sm:w-[22%] w-full border border-gray-300 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg p-3 text-sm">
          <option value="" selected="">Kurslar</option>
          <option value="1" {% if filter_by_type == 'birinchi' %}selected{% endif %}>1-kurs</option>
          <option value="2" {% if filter_by_type == 'ikkinchi' %}selected{% endif %}>2-kurs</option>
          <option value="3" {% if filter_by_type == 'uchinchi' %}selected{% endif %}>3-kurs</option>
          <option value="4" {% if filter_by_type == 'turtinchi' %}selected{% endif %}>4-kurs</option>
          <option value="5" {% if filter_by_type == 'beshinchi' %}selected{% endif %}>5-kurs</option>
        </select>

        <!-- Qidiruv -->
        <div class="sm:w-[36%] w-full relative">
          <input type="search" id="default-search" name='search'
            class="block w-full p-3 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Nomi bo'yicha qidirish" {% if search_query %} value="{{ search_query }}" {% endif %} />
          <svg class="w-5 h-5 text-gray-500 absolute right-3 top-1/2 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
          </svg>
        </div>

        <!-- Tugma -->
        <button type="submit"
          class="sm:w-[15%] w-full p-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-2 focus:ring-blue-400 transition">
          Qidiruv
        </button>

      </form>
    </div>

    {% comment %}  {% endcomment %}
    {% comment %} diagram qismi uchun  {% endcomment %}
<div class="matrix-wrapper" 
     style="grid-template-columns: 200px {% for fan in fanlar %}25px {% endfor %};">
  <!-- Header: fanlar -->
  <div class="matrix-header">
    <div class="corner"></div>
    {% for fan in fanlar %}
      
        <div class="fan-title" data-fan="{{ fan.id }}"><span>{{ fan.title }}</span></div>
      
    {% endfor %}
  </div>

  <!-- Body: o'qituvchilar va kataklar -->
  <div class="matrix-body">
    {% for worker in workers %}
      <a href="{% url 'home:muayyan_xodim' worker.slug %}">
        <div class="teacher-name" data-worker="{{ worker.id }}">{{ worker.familiya }} {{ worker.ism }}</div>
      </a>  
      {% for fan in fanlar %}
        <div class="cell {% if worker in fan.workers.all %}active{% endif %}" 
             data-fan="{{ fan.id }}" 
             data-worker="{{ worker.id }}">
        </div>
      {% endfor %}
    {% endfor %}
  </div>
</div>



<style>
.matrix-wrapper {
  display: grid;
  gap: 0; 
  background: #f8fafc;
  padding: 12px;
  border-radius: 14px;
}

.matrix-header,
.matrix-body {
  display: contents;
}

.fan-title {
  width: 25px;
  height: 240px;
  position: relative;
  
  display: flex;
  justify-content: center;
  align-items: flex-end;

  cursor: pointer;
}


.fan-title::before {
  content: "";
  position: absolute;
  bottom: 0;
  left: 96%;

  width: 3px;
  height: 200px;
  background: #e5e7eb;

  transform:  rotate(35deg);
  
}

.fan-title span {
  position: absolute;
  left: 50%;
  z-index: 999;
  transform: rotate(-55deg);
  transform-origin: bottom left;
  font-size: 12px;
  font-weight: 600;
  padding-left: 2px;
  white-space: nowrap;
  
}
.fan-title::before {
  
 

  width: 1px;
  height: 90px;
  background: #cbd5e1;
  pointer-events: none; 
  z-index: -1;
 
}

.teacher-name {
  height: 24px;               /* ðŸ”‘ cell height bilan aynan */
  display: flex;
  align-items: center;
  padding-left: 8px;
  font-size: 13px;
  background: #fff;
  border-right: 1px solid #e5e7eb;
}


.cell {
  width: 24px;
  height: 24px;
  background: #e5e7eb;
  border-radius: 2px;           /* ðŸ”‘ jips koâ€˜rinish */
}
.cell.active {
  background: #c7d2fe;
}


.highlight-cell {
  background: #38bdf8 !important;
}

.highlight-text {
  background: #e0f2fe;
  color: #0284c7;
  font-weight: 600;
}


</style>
{% comment %} diagram qismi uchun  {% endcomment %}

    {% comment %}  {% endcomment %}
    <!-- resources -->
    <div class="bg-slate-100 w-full flex justify-between items-center py-6">
      <div class="w-full bg-white bg-opacity-70 backdrop-filter backdrop-blur-md rounded-2xl shadow-sm">
        <div class="w-11/12 mx-auto rounded-2xl">
          <div class="space-y-6 mx-auto">
            {% if fanlar %}
            {% for fan in fanlar %}
              <a href="{% url 'home:fan_tarkibi' fan.slug %}" class="no-underline hover:no-underline">
                <article
                  class="bg-white p-5 shadow-md transition duration-300 hover:shadow-lg rounded-xl border border-gray-200 flex flex-col md:flex-row gap-6 items-start">
                  
                  <!-- Chap tomonda rasm -->
                  <div class="w-full md:w-1/3">
                    <img
                      class="rounded-lg w-full h-44 object-cover border border-gray-200"
                      {% if fan.image %}src="{{ fan.image.url }}" {% else %}src="{% static 'img/subject.png' %}" {% endif %}
                      alt="fan rasmi" />
                  </div>
                  
                  <!-- Oâ€˜ng tomonda matn -->
                  <div class="flex-1 text-start">
                    <h3 class="font-semibold text-xl text-sky-900 mb-3">
                      {{ fan.title }}
                    </h3>
                    <p class="text-gray-700 leading-relaxed">
                      {{fan.title}}ga tegishli barcha hujjatlar jamlanmasi
                    </p>
                  </div>
                </article>
              </a>
            {% endfor %}
            {% else %}
            <h1 class="common_title text-center text-sky-900 font-semibold text-lg">
              Hozircha bu filtr boâ€˜yicha resurslar mavjud emas!
            </h1>
            {% endif %}
          </div>
        </div>
      </div>
    </div>


    <!-- Pagination -->
    <div class="max-w-screen-xl mx-auto p-4 sm:mb-28 mb-14">
      <nav aria-label="Page navigation example ">
        <ul class="flex items-center justify-center -space-x-px h-10 text-base">
            <li>
            <a href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{{ pagination_url }}{% endif %}"
                class="flex items-center justify-center px-4 h-10 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                <span class="sr-only">Previous</span>
                <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4" />
                </svg>
            </a>
            </li>
            {% for page in page_obj.paginator.page_range %}
            <li>
                <a href="?page={{ page }}{{ pagination_url }}"
                    class="flex items-center justify-center px-4 h-10 leading-tight {% if page == page_obj.number %}text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white{% else %}text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white{% endif %}">
                {{ page }}
                </a>
            </li>
            {% endfor %}
            <li>
            <a href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{{ pagination_url }}{% endif %}"
                class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
                <span class="sr-only">Next</span>
                <svg class="w-3 h-3 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4" />
                </svg>
            </a>
            </li>
        </ul>
      </nav>
    </div>
    
  

</div>







{% endblock context %}

  
{% block addscript %}
<script src="{% static 'js/main.js' %}"></script>

{% comment %} diagramma uchun {% endcomment %}

<script>
document.querySelectorAll('.fan-title').forEach(fanEl => {
  fanEl.addEventListener('mouseenter', () => {
    const fanId = fanEl.dataset.fan;

    // Fan nomi
    fanEl.classList.add('highlight-text');

    // Shu fan bilan bogâ€˜langan kataklar
    document.querySelectorAll(`.cell[data-fan="${fanId}"].active`)
      .forEach(cell => {
        cell.classList.add('highlight-cell');

        // Mos oâ€˜qituvchi
        const workerId = cell.dataset.worker;
        document
          .querySelector(`.teacher-name[data-worker="${workerId}"]`)
          .classList.add('highlight-text');
      });
  });

  fanEl.addEventListener('mouseleave', () => {
    document.querySelectorAll('.highlight-cell')
      .forEach(el => el.classList.remove('highlight-cell'));

    document.querySelectorAll('.highlight-text')
      .forEach(el => el.classList.remove('highlight-text'));
  });
});
</script>
<script>
document.querySelectorAll('.fan-title').forEach(fanEl => {
  fanEl.addEventListener('mouseenter', () => {
    const fanId = fanEl.dataset.fan;

    // Fan nomi matnini highlight qilamiz
    fanEl.classList.add('highlight-text');

    // Shu fan bilan bog'liq kataklar va o'qituvchi nomini highlight qilamiz
    document.querySelectorAll(`.cell[data-fan="${fanId}"].active`).forEach(cell => {
      cell.classList.add('highlight-cell');

      // Mos o'qituvchi nomini highlight qilamiz
      const workerId = cell.dataset.worker;
      const teacherEl = document.querySelector(`.teacher-name[data-worker="${workerId}"]`);
      if (teacherEl) teacherEl.classList.add('highlight-text');
    });
  });

  fanEl.addEventListener('mouseleave', () => {
    // Barcha highlightlarni olib tashlaymiz
    document.querySelectorAll('.highlight-cell').forEach(el => el.classList.remove('highlight-cell'));
    document.querySelectorAll('.highlight-text').forEach(el => el.classList.remove('highlight-text'));
  });
});
</script>
<script>
  // Fan ustiga hover
// Fan ustiga hover
document.querySelectorAll('.fan-title').forEach(fanEl => {
  fanEl.addEventListener('mouseenter', () => {
    const fanId = fanEl.dataset.fan;

    // Fan nomini highlight qilish
    fanEl.classList.add('highlight-text');

    // Shu fan bilan bogâ€˜langan kataklar
    document.querySelectorAll(`.cell[data-fan="${fanId}"].active`)
      .forEach(cell => cell.classList.add('highlight-cell'));

    // Shu fan bilan bogâ€˜langan o'qituvchilar
    document.querySelectorAll('.teacher-name').forEach(teacher => {
      const workerId = teacher.dataset.worker;
      if(document.querySelector(`.cell[data-fan="${fanId}"][data-worker="${workerId}"].active`)){
        teacher.classList.add('highlight-text');
      }
    });
  });

  fanEl.addEventListener('mouseleave', () => {
    const fanId = fanEl.dataset.fan;
    fanEl.classList.remove('highlight-text');
    document.querySelectorAll(`.cell[data-fan="${fanId}"].active`).forEach(cell => cell.classList.remove('highlight-cell'));
    document.querySelectorAll('.teacher-name').forEach(teacher => teacher.classList.remove('highlight-text'));
  });
});


// O'qituvchi ustiga hover
document.querySelectorAll('.teacher-name').forEach(teacherEl => {
  teacherEl.addEventListener('mouseenter', () => {
    const workerId = teacherEl.dataset.worker;

    // O'qituvchi nomini highlight qilish
    teacherEl.classList.add('highlight-text');

    // Shu o'qituvchiga tegishli kataklar va fan nomlarini highlight qilish
    document.querySelectorAll(`.cell[data-worker="${workerId}"].active`)
      .forEach(cell => {
        cell.classList.add('highlight-cell');

        const fanId = cell.dataset.fan;
        const fanEl = document.querySelector(`.fan-title[data-fan="${fanId}"]`);
        if(fanEl){
          fanEl.classList.add('highlight-text');
        }
      });
  });

  teacherEl.addEventListener('mouseleave', () => {
    teacherEl.classList.remove('highlight-text');
    document.querySelectorAll('.cell.highlight-cell').forEach(cell => cell.classList.remove('highlight-cell'));
    document.querySelectorAll('.fan-title.highlight-text').forEach(fan => fan.classList.remove('highlight-text'));
  });
});

</script>
{% comment %} diagramma uchun {% endcomment %}
{% endblock addscript %}
